<!doctype html>
<html class="docs-version-current" lang="en" dir="ltr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<meta name="generator" content="Docusaurus v2.0.0-beta.15">
<title data-react-helmet="true">Technical Overview | Metaflow Docs</title><meta data-react-helmet="true" name="twitter:card" content="summary_large_image"><meta data-react-helmet="true" property="og:image" content="https://your-docusaurus-test-site.com/img/Metaflow_Logo_Vertical_FullColor_Ribbon_Dark_RGB.png"><meta data-react-helmet="true" name="twitter:image" content="https://your-docusaurus-test-site.com/img/Metaflow_Logo_Vertical_FullColor_Ribbon_Dark_RGB.png"><meta data-react-helmet="true" property="og:url" content="https://your-docusaurus-test-site.com/docs/python/internals-of-metaflow/technical-overview"><meta data-react-helmet="true" name="docusaurus_locale" content="en"><meta data-react-helmet="true" name="docusaurus_version" content="current"><meta data-react-helmet="true" name="docusaurus_tag" content="docs-default-current"><meta data-react-helmet="true" property="og:title" content="Technical Overview | Metaflow Docs"><meta data-react-helmet="true" name="description" content="Make sure you have read Basics of Metaflow before diving into technical details below. You can find more technical details at the infrastructure level in Administrator&#x27;s Guide to Metaflow. This document focuses on the Metaflow codebase."><meta data-react-helmet="true" property="og:description" content="Make sure you have read Basics of Metaflow before diving into technical details below. You can find more technical details at the infrastructure level in Administrator&#x27;s Guide to Metaflow. This document focuses on the Metaflow codebase."><link data-react-helmet="true" rel="icon" href="/img/favicon.ico"><link data-react-helmet="true" rel="canonical" href="https://your-docusaurus-test-site.com/docs/python/internals-of-metaflow/technical-overview"><link data-react-helmet="true" rel="alternate" href="https://your-docusaurus-test-site.com/docs/python/internals-of-metaflow/technical-overview" hreflang="en"><link data-react-helmet="true" rel="alternate" href="https://your-docusaurus-test-site.com/docs/python/internals-of-metaflow/technical-overview" hreflang="x-default"><link rel="stylesheet" href="/assets/css/styles.b6079987.css">
<link rel="preload" href="/assets/js/runtime~main.18202839.js" as="script">
<link rel="preload" href="/assets/js/main.63319ee9.js" as="script">
</head>
<body data-theme="light">
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"light")}()</script><div id="__docusaurus">
<div role="region"><a href="#" class="skipToContent_ZgBM">Skip to main content</a></div><nav class="navbar navbar--fixed-top navbarHideable_aKYr"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Navigation bar toggle" class="navbar__toggle clean-btn" type="button" tabindex="0"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/docs"><div class="navbar__logo"><img src="/img/Metaflow_Logo_Horizontal_OneColor_White_RGB.svg" alt="Metaflow Logo" class="themedImage_W2Cr themedImage--light_TfLj" height="64px"><img src="/img/Metaflow_Logo_Horizontal_OneColor_White_RGB.svg" alt="Metaflow Logo" class="themedImage_W2Cr themedImage--dark_oUvU" height="64px"></div></a><a class="navbar__item navbar__link navbar__link--active" href="/docs/python">Python Docs</a><a class="navbar__item navbar__link" href="/docs/r">R Docs</a><a href="https://admin-docs.metaflow.org/" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link"><span>Admin Docs<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_I5OW"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a></div><div class="navbar__items navbar__items--right"><div class="dsla-search-wrapper"><div class="dsla-search-field" data-tags="default,docs-default-current"></div></div><div class="toggle_Pssr toggle_TdHA toggleDisabled_jDku"><div class="toggleTrack_SSoT" role="button" tabindex="-1"><div class="toggleTrackCheck_XobZ"><span class="toggleIcon_eZtF">ðŸŒœ</span></div><div class="toggleTrackX_YkSC"><span class="toggleIcon_eZtF">ðŸŒž</span></div><div class="toggleTrackThumb_uRm4"></div></div><input type="checkbox" class="toggleScreenReader_JnkT" aria-label="Switch between dark and light mode"></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div class="main-wrapper docs-wrapper docs-doc-page"><div class="docPage_P2Lg"><button aria-label="Scroll back to top" class="clean-btn theme-back-to-top-button backToTopButton_RiI4" type="button"></button><aside class="theme-doc-sidebar-container docSidebarContainer_rKC_"><div class="sidebar_CW9Y sidebarWithHideableNavbar_FoYL"><a tabindex="-1" class="sidebarLogo_FJUI" href="/docs"><img src="/img/Metaflow_Logo_Horizontal_OneColor_White_RGB.svg" alt="Metaflow Logo" class="themedImage_W2Cr themedImage--light_TfLj" height="64px"><img src="/img/Metaflow_Logo_Horizontal_OneColor_White_RGB.svg" alt="Metaflow Logo" class="themedImage_W2Cr themedImage--dark_oUvU" height="64px"></a><nav class="menu thin-scrollbar menu_SkdO"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/python">Welcome to Metaflow for Python</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist hasHref_VCh3" href="/docs/python/introduction/why-metaflow">Introduction</a></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/python/introduction/why-metaflow">Why Metaflow</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/python/introduction/what-is-metaflow">What is Metaflow</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/python/introduction/release-notes">Release Notes</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/python/introduction/roadmap">Roadmap</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/python/introduction/contributing-to-metaflow">Contributing to Metaflow</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/python/introduction/getting-in-touch">Get in Touch</a></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist hasHref_VCh3" href="/docs/python/getting-started/install">Getting Started</a></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/python/getting-started/install">Installing Metaflow</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link hasHref_VCh3" tabindex="0" href="/docs/python/getting-started/tutorials">Tutorials</a><button aria-label="Toggle the collapsible sidebar category &#x27;Tutorials&#x27;" type="button" class="clean-btn menu__caret"></button></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-3 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link hasHref_VCh3" tabindex="0" href="/docs/python/getting-started/tutorials/season-1-the-local-experience">Season 1: The Local Experience</a><button aria-label="Toggle the collapsible sidebar category &#x27;Season 1: The Local Experience&#x27;" type="button" class="clean-btn menu__caret"></button></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-4 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/python/getting-started/tutorials/season-1-the-local-experience/episode00">Episode 0: Hello World</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-4 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/python/getting-started/tutorials/season-1-the-local-experience/episode01">Episode 1: Playlist</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-4 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/python/getting-started/tutorials/season-1-the-local-experience/episode02">Episode 2: Statistics</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-4 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/python/getting-started/tutorials/season-1-the-local-experience/episode03">Episode 3: Playlist Redux</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-4 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/python/getting-started/tutorials/season-1-the-local-experience/episode04">Episode 4: Playlist Plus</a></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-3 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link hasHref_VCh3" tabindex="0" href="/docs/python/getting-started/tutorials/season-2-scaling-out-and-up">Season 2: Scaling Out and Up</a><button aria-label="Toggle the collapsible sidebar category &#x27;Season 2: Scaling Out and Up&#x27;" type="button" class="clean-btn menu__caret"></button></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-4 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/python/getting-started/tutorials/season-2-scaling-out-and-up/episode05">Episode 5: Hello AWS</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-4 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/python/getting-started/tutorials/season-2-scaling-out-and-up/episode06">Episode 6: Statistics Redux</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-4 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/python/getting-started/tutorials/season-2-scaling-out-and-up/episode07">Episode 7: Worldview</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-4 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/python/getting-started/tutorials/season-2-scaling-out-and-up/episode-8-autopilot">Episode 8: Autopilot</a></li></ul></li></ul></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist hasHref_VCh3" href="/docs/python/metaflow-on-aws">Metaflow on AWS</a></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/python/metaflow-on-aws">Metaflow on AWS</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/python/metaflow-on-aws/metaflow-sandbox">Metaflow Sandbox</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/python/metaflow-on-aws/deploy-to-aws">Deploying to AWS</a></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist hasHref_VCh3" href="/docs/python/metaflow/basics">Developing with Metaflow</a></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/python/metaflow/basics">Basics of Metaflow</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/python/metaflow/client">Inspecting Flows and Results</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link hasHref_VCh3" tabindex="0" href="/docs/python/metaflow/visualizing-results">Visualizing Results</a><button aria-label="Toggle the collapsible sidebar category &#x27;Visualizing Results&#x27;" type="button" class="clean-btn menu__caret"></button></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/python/metaflow/visualizing-results/effortless-task-inspection-with-default-cards">Effortless Task Inspection with Default Cards</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/python/metaflow/visualizing-results/easy-custom-reports-with-card-components">Easy Custom Reports with Card Components</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/python/metaflow/visualizing-results/advanced-shareable-cards-with-card-templates">Advanced, Shareable Cards with Card Templates</a></li></ul></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/python/metaflow/debugging">Debugging with Metaflow</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/python/metaflow/scaling">Scaling Out and Up</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/python/metaflow/data">Loading and Storing Data</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/python/metaflow/dependencies">Managing External Libraries</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/python/metaflow/failures">Dealing with Failures</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/python/metaflow/tagging">Organizing Results</a></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist hasHref_VCh3" href="/docs/python/going-to-production-with-metaflow/scheduling-metaflow-flows">Going to Production with Metaflow</a></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/python/going-to-production-with-metaflow/scheduling-metaflow-flows">Scheduling Metaflow Flows</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/python/going-to-production-with-metaflow/coordinating-larger-metaflow-projects">Coordinating Larger Metaflow Projects</a></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--active hasHref_VCh3" aria-current="page" href="/docs/python/internals-of-metaflow/technical-overview">Internals of Metaflow</a></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" tabindex="0" href="/docs/python/internals-of-metaflow/technical-overview">Technical Overview</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/python/internals-of-metaflow/testing-philosophy">Testing Philosophy</a></li></ul></li></ul></nav></div></aside><main class="docMainContainer_TCnq"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_DM6M"><div class="docItemContainer_vinB"><article><div class="tocCollapsible_jdIR theme-doc-toc-mobile tocMobile_TmEX"><button type="button" class="clean-btn tocCollapsibleButton_Fzxq">On this page</button></div><div class="theme-doc-markdown markdown"><h1>Technical Overview</h1><p>Make sure you have read <a href="/docs/python/metaflow/basics">Basics of Metaflow</a> before diving into technical details below. You can find more technical details at the infrastructure level in <a href="https://admin-docs.metaflow.org" target="_blank" rel="noopener noreferrer">Administrator&#x27;s Guide to Metaflow</a>. This document focuses on the Metaflow codebase.</p><p>We wanted to build a data science platform that can make data science code usable, scalable, reproducible, and production-ready, as described in the <a href="/docs/python/introduction/why-metaflow">Why Metaflow</a> section. There are many ways to achieve these high-level goals. We took an approach designed around the following four core functions:</p><ol><li>Provide a highly usable API for structuring the code as a workflow, i.e. as a directed graph of steps (<strong>usability</strong>).</li><li>Persist an immutable snapshot of data, code, and external dependencies required to execute each step (<strong>reproducibility</strong>).</li><li>Facilitate execution of the steps in various environments, from development to production (<strong>scalability</strong>, <strong>production-readiness</strong>).</li><li>Record metadata about previous executions and make them easily accessible (<strong>usability</strong>, <strong>reproducibility</strong>).</li></ol><p>This document gives an overview of how the core functionality is implemented.</p><h2 class="anchor anchorWithHideOnScrollNavbar_R0VQ" id="architecture">Architecture<a class="hash-link" href="#architecture" title="Direct link to heading">â€‹</a></h2><p>Here is a high-level architecture diagram of Metaflow:</p><p><img src="/assets/images/Untitled_presentation-34865e5b1cf54ada93d00a186bc75832.png" width="710" height="828"></p><p>Below, we will describe the components in detail. To highlight the time-dimension which is missing from the diagram, we group the descriptions by the following phases in the development lifecycle:</p><ol><li>Development-time, i.e. when the code gets written.</li><li>Runtime, i.e. when the code gets run.</li><li>Result-time, i.e. when the results of the run get used.</li></ol><p>Every component includes links to source files where the functionality is implemented.</p><h2 class="anchor anchorWithHideOnScrollNavbar_R0VQ" id="development-time-components">Development-Time Components<a class="hash-link" href="#development-time-components" title="Direct link to heading">â€‹</a></h2><p>The core development-time concept in Metaflow is a <em>flow</em>. It represents the business logic of what needs to be computed.</p><p>How to intertwine the business logic with the framework in the most <strong>usable</strong> manner is a central design concern of Metaflow. We want to encourage the user to structure the code in a way that enables <strong>reproducibility</strong> and <strong>scalability</strong>.</p><p>In contrast, we would like to minimize concerns related to production-readiness during development time. Optimally, the user can write idiomatic Python code focusing on the logic itself and the guard rails of the framework will automatically make the code production-ready.</p><h3 class="anchor anchorWithHideOnScrollNavbar_R0VQ" id="flow"><strong>Flow</strong><a class="hash-link" href="#flow" title="Direct link to heading">â€‹</a></h3><p>A flow is the smallest unit of computation that can be scheduled for execution. Typically, a flow defines a workflow that pulls data from an external source as input, processes it in several steps, and produces output data.</p><p>User implements a flow by subclassing <code>FlowSpec</code> and implementing steps as methods. Besides steps, a flow can define other attributes relevant for scheduling, such as parameters and data triggers.</p><ul><li><a href="https://github.com/Netflix/metaflow/blob/master/metaflow/flowspec.py" target="_blank" rel="noopener noreferrer"><code>flowspec.py</code> - base class for flows</a></li></ul><h3 class="anchor anchorWithHideOnScrollNavbar_R0VQ" id="graph">Graph<a class="hash-link" href="#graph" title="Direct link to heading">â€‹</a></h3><p>Metaflow infers a directed (typically acyclic) graph based on the transitions between step functions.</p><p>Metaflow requires the transitions to be defined so that the graph can be parsed from the source code of the flow statically. This makes it possible to translate the graph for execution by runtimes that support only statically defined graphs, such as Meson.</p><ul><li><a href="https://github.com/Netflix/metaflow/blob/master/metaflow/graph.py" target="_blank" rel="noopener noreferrer"><code>graph.py</code> - internal representation of the graph</a></li><li><a href="https://github.com/Netflix/metaflow/blob/master/metaflow/lint.py" target="_blank" rel="noopener noreferrer"><code>lint.py</code> - verifies that the graph is valid</a></li></ul><h3 class="anchor anchorWithHideOnScrollNavbar_R0VQ" id="step">Step<a class="hash-link" href="#step" title="Direct link to heading">â€‹</a></h3><p>A step is the smallest resumable unit of computation. It is implemented by the user as a method that is decorated with the <code>@step</code> decorator in a flow class.</p><p>A step is <a href="https://en.wikipedia.org/wiki/Application_checkpointing" target="_blank" rel="noopener noreferrer">a checkpoint</a>. Metaflow takes a snapshot of the data produced by a step which in turn is used as input to the subsequent steps. Hence if a step fails, it can be resumed without rerunning the preceding steps.</p><p>Being able to resume execution is a powerful feature. It would be convenient to be able to resume execution at any arbitrary line of code. The main reason why checkpointing is done at the step level instead of line level is the overhead of saving state. The user is encouraged to keep the steps small but not so small that the overhead becomes noticeable.</p><ul><li><a href="https://github.com/Netflix/metaflow/blob/master/metaflow/flowspec.py" target="_blank" rel="noopener noreferrer"><code>flowspec.py</code> - steps belong to a flow</a></li></ul><h3 class="anchor anchorWithHideOnScrollNavbar_R0VQ" id="decorators">Decorators<a class="hash-link" href="#decorators" title="Direct link to heading">â€‹</a></h3><p>The behavior of a step can be modified with decorators. Tags are the main mechanism for extending Metaflow. For instance, a decorator can catch exceptions, implement a timeout, or define resource requirements for a step.</p><p>A step may have arbitrary many decorators, implemented as Python decorators.</p><ul><li><a href="https://github.com/Netflix/metaflow/blob/master/metaflow/decorators.py" target="_blank" rel="noopener noreferrer"><code>decorators.py</code> - base class for decorators</a></li><li><a href="https://github.com/Netflix/metaflow/tree/master/metaflow/plugins" target="_blank" rel="noopener noreferrer"><code>plugins</code> - see various plugins for actual decorator implementations</a></li></ul><h3 class="anchor anchorWithHideOnScrollNavbar_R0VQ" id="step-code">Step Code<a class="hash-link" href="#step-code" title="Direct link to heading">â€‹</a></h3><p>Step code is the body of a step. It implements the actual business logic of flow.</p><p>It is possible to implement various language bindings, e.g. R, for Metaflow so that only the language of the step code is changed while all the core functionality, implemented in Python, stays intact.</p><p>All instance variables, e.g. <code>self.x</code>, used in the step code become <em>data artifacts</em> that are persisted automatically. Stack variables, e.g. <code>x</code>, are not persisted. This dichotomy allows the user to control the overhead of checkpointing by explicitly choosing between persistent vs. non-persistent variables in the step code.</p><ul><li><a href="https://github.com/Netflix/metaflow/blob/master/metaflow/tutorials/00-helloworld/helloworld.py" target="_blank" rel="noopener noreferrer"><code>helloworld.py</code> - example of a user-defined flow</a></li></ul><h2 class="anchor anchorWithHideOnScrollNavbar_R0VQ" id="runtime-components">Runtime Components<a class="hash-link" href="#runtime-components" title="Direct link to heading">â€‹</a></h2><p>The core runtime concept in Metaflow is a <em>run</em>, that is, an execution of a user-defined flow. A run happens when the user executes <code>python myflow.py run</code> on the command line.</p><p>A key design decision of Metaflow is to make the framework runtime-agnostic. The same code should be runnable in various environments, such as on a laptop during development or on a <strong>production-ready</strong> workflow orchestrator during production.</p><p>Similarly, we want to provide seamless <strong>scalability</strong> by allowing the same code run on a laptop in parallel over multiple processes or in the cloud over multiple batch jobs.</p><h3 class="anchor anchorWithHideOnScrollNavbar_R0VQ" id="task"><strong>Task</strong><a class="hash-link" href="#task" title="Direct link to heading">â€‹</a></h3><p>The runtime counterpart of a step is a <em>task</em>. In runtime, a normal step spawns one task for execution. A foreach split step may spawn multiple tasks which are identified by a unique <em>foreach stack</em>.</p><ul><li><a href="https://github.com/Netflix/metaflow/blob/master/metaflow/task.py" target="_blank" rel="noopener noreferrer"><code>task.py</code> - manages execution of a task</a></li></ul><h3 class="anchor anchorWithHideOnScrollNavbar_R0VQ" id="code-package">Code Package<a class="hash-link" href="#code-package" title="Direct link to heading">â€‹</a></h3><p>In order to be able to <strong>reproduce</strong> the results of a run, we need to snapshot the code that was run.</p><p>Code package is an immutable snapshot of the relevant code in the working directory, stored in the datastore, at the time when the run was started. A convenient side-effect of the snapshot is that it also works as a code distribution mechanism for runs that happen in the cloud.</p><ul><li><a href="https://github.com/Netflix/metaflow/blob/master/metaflow/package.py" target="_blank" rel="noopener noreferrer"><code>package.py</code> - code package implementation</a></li></ul><h3 class="anchor anchorWithHideOnScrollNavbar_R0VQ" id="environment"><strong>Environment</strong><a class="hash-link" href="#environment" title="Direct link to heading">â€‹</a></h3><p>Unfortunately, just snapshotting the working directory of the flow code is not sufficient for reproducibility. The code often depends on external libraries which also need to be included in the snapshot.</p><p>The concept of an <em>environment</em> is closely related to code packages. The environment encapsulates both the flow code and its external dependencies, so that the exact execution environment can be reproduced on a remote system accurately.</p><ul><li><a href="https://github.com/Netflix/metaflow/blob/master/metaflow/metaflow_environment.py" target="_blank" rel="noopener noreferrer"><code>metaflow_environment.py</code> - environment base class</a></li></ul><h3 class="anchor anchorWithHideOnScrollNavbar_R0VQ" id="runtime">Runtime<a class="hash-link" href="#runtime" title="Direct link to heading">â€‹</a></h3><p>A run of a flow is executed by executing tasks defined by steps in a topological order. It is the job of a runtime to orchestrate this execution. A better name for &quot;runtime&quot; might be a scheduler.</p><p>For quick local iterations, Metaflow comes with a built-in runtime which executes tasks as separate processes. However, this is not intended as a production-grade scheduler.</p><p>For production runs, one should use a runtime that supports retries, error reporting, logging, is highly available, scalable, and preferably comes with a user-friendly UI. At Netflix, <a href="https://medium.com/netflix-techblog/meson-workflow-orchestration-for-netflix-recommendations-fc932625c1d9" target="_blank" rel="noopener noreferrer">Meson</a> is such a runtime. It is well supported by Metaflow.</p><p>A key feature of Metaflow is that it is agnostic of the runtime. The same code can be executed both with the local runtime as well as with production runtime, which enables a rapid development-deploy-debug cycle.</p><ul><li><a href="https://github.com/Netflix/metaflow/blob/master/metaflow/runtime.py" target="_blank" rel="noopener noreferrer"><code>runtime.py</code> - local, process-based runtime</a></li></ul><h3 class="anchor anchorWithHideOnScrollNavbar_R0VQ" id="datastore">Datastore<a class="hash-link" href="#datastore" title="Direct link to heading">â€‹</a></h3><p>Metaflow requires an object store where both code snapshots as well as data artifacts can be persisted. This data store should be accessible by all environments where Metaflow code is executed. The AWS S3 is a perfect solution for this need. Secondarily, Metaflow supports using a local disk as a data store, which is mainly useful during the development of Metaflow itself.</p><p>An important feature of Metaflow is that the data store is used as a content-addressed storage. Both code and data are identified by a hash of their contents, similar to Git, so equal copies of data are deduplicated automatically. Note that this deduplication is limited in scope however; data across different flows will not be deduplicated.</p><ul><li><a href="https://github.com/Netflix/metaflow/blob/master/metaflow/datastore/datastore.py" target="_blank" rel="noopener noreferrer"><code>datastore.py</code> - base class for datastores</a></li><li><a href="https://github.com/Netflix/metaflow/blob/master/metaflow/datastore/s3.py" target="_blank" rel="noopener noreferrer"><code>s3.py</code> - default S3 datastore</a></li></ul><h3 class="anchor anchorWithHideOnScrollNavbar_R0VQ" id="metadata-provider">Metadata Provider<a class="hash-link" href="#metadata-provider" title="Direct link to heading">â€‹</a></h3><p>A centralized Metadata Provider keeps track of runs. Strictly speaking, this functionality is not required by Metaflow but it makes the system much more <strong>usable.</strong> The service also helps to make data artifacts and other metadata about runs more discoverable during result-time, as explained below.</p><ul><li>`<!-- -->`<a href="https://github.com/Netflix/metaflow/blob/master/metaflow/metadata/metadata.py" target="_blank" rel="noopener noreferrer"><code>metadata.py</code> - base class for metadata providers</a></li><li>`<!-- -->`<a href="https://github.com/Netflix/metaflow/blob/master/metaflow/plugins/metadata/service.py" target="_blank" rel="noopener noreferrer"><code>service.py</code> - default implementation of the metadata provider</a></li><li>`<!-- -->`<a href="https://github.com/Netflix/metaflow/blob/master/metaflow/plugins/metadata/local.py" target="_blank" rel="noopener noreferrer"><code>local.py</code> - local implementation of the metadata provider</a></li></ul><h2 class="anchor anchorWithHideOnScrollNavbar_R0VQ" id="result-time-components">Result-time Components<a class="hash-link" href="#result-time-components" title="Direct link to heading">â€‹</a></h2><p>Flows are defined and run for their results. Metaflow supports a number of different ways to consume outputs of runs: Results can be written to Hive tables for consumption by downstream systems and dashboards, they can be accessed in a notebook for further analysis, or in a hosted web service (this last functionality is not yet available in Open Source).</p><h3 class="anchor anchorWithHideOnScrollNavbar_R0VQ" id="metaflow-client">Metaflow Client<a class="hash-link" href="#metaflow-client" title="Direct link to heading">â€‹</a></h3><p>Metaflow provides a highly <strong>usable</strong> Python API to access results of previous runs, called <code>metaflow.client</code>. A typical way to use <code>metaflow.client</code> is to access data artifacts of past runs in a Jupyter notebook. It is extremely convenient to be able to examine the internal state of production runs or perform further ad-hoc analysis of the results in a notebook.</p><ul><li><a href="https://github.com/Netflix/metaflow/tree/master/metaflow/client" target="_blank" rel="noopener noreferrer"><code>metaflow.client</code> - client subpackage</a></li><li><a href="https://github.com/Netflix/metaflow/blob/master/metaflow/client/core.py" target="_blank" rel="noopener noreferrer"><code>core.py</code> - core objects for the client</a></li></ul></div><footer class="theme-doc-footer docusaurus-mt-lg"><div class="theme-doc-footer-edit-meta-row row"><div class="col"><a href="https://github.dev/outerbounds/docusaurus/blob/main/docs/python/internals-of-metaflow/technical-overview.md" target="_blank" rel="noreferrer noopener" class="theme-edit-this-page"><svg fill="currentColor" height="20" width="20" viewBox="0 0 40 40" class="iconEdit_dcUD" aria-hidden="true"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>Edit this page</a></div><div class="col lastUpdated_foO9"></div></div></footer></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Docs pages navigation"><div class="pagination-nav__item"><a class="pagination-nav__link" href="/docs/python/going-to-production-with-metaflow/coordinating-larger-metaflow-projects"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">Coordinating Larger Metaflow Projects</div></a></div><div class="pagination-nav__item pagination-nav__item--next"><a class="pagination-nav__link" href="/docs/python/internals-of-metaflow/testing-philosophy"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">Testing Philosophy</div></a></div></nav></div></div><div class="col col--3"><div class="tableOfContents_cNA8 thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#architecture" class="table-of-contents__link toc-highlight">Architecture</a></li><li><a href="#development-time-components" class="table-of-contents__link toc-highlight">Development-Time Components</a><ul><li><a href="#flow" class="table-of-contents__link toc-highlight"><strong>Flow</strong></a></li><li><a href="#graph" class="table-of-contents__link toc-highlight">Graph</a></li><li><a href="#step" class="table-of-contents__link toc-highlight">Step</a></li><li><a href="#decorators" class="table-of-contents__link toc-highlight">Decorators</a></li><li><a href="#step-code" class="table-of-contents__link toc-highlight">Step Code</a></li></ul></li><li><a href="#runtime-components" class="table-of-contents__link toc-highlight">Runtime Components</a><ul><li><a href="#task" class="table-of-contents__link toc-highlight"><strong>Task</strong></a></li><li><a href="#code-package" class="table-of-contents__link toc-highlight">Code Package</a></li><li><a href="#environment" class="table-of-contents__link toc-highlight"><strong>Environment</strong></a></li><li><a href="#runtime" class="table-of-contents__link toc-highlight">Runtime</a></li><li><a href="#datastore" class="table-of-contents__link toc-highlight">Datastore</a></li><li><a href="#metadata-provider" class="table-of-contents__link toc-highlight">Metadata Provider</a></li></ul></li><li><a href="#result-time-components" class="table-of-contents__link toc-highlight">Result-time Components</a><ul><li><a href="#metaflow-client" class="table-of-contents__link toc-highlight">Metaflow Client</a></li></ul></li></ul></div></div></div></div></main></div></div></div>
<script src="/assets/js/runtime~main.18202839.js"></script>
<script src="/assets/js/main.63319ee9.js"></script>
</body>
</html>