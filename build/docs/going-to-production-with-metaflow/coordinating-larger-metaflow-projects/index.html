<!doctype html>
<html class="docs-version-current" lang="en" dir="ltr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<meta name="generator" content="Docusaurus v2.0.0-beta.15">
<title data-react-helmet="true">Coordinating Larger Metaflow Projects | My Site</title><meta data-react-helmet="true" name="twitter:card" content="summary_large_image"><meta data-react-helmet="true" property="og:url" content="https://your-docusaurus-test-site.com/docs/going-to-production-with-metaflow/coordinating-larger-metaflow-projects"><meta data-react-helmet="true" name="docusaurus_locale" content="en"><meta data-react-helmet="true" name="docusaurus_version" content="current"><meta data-react-helmet="true" name="docusaurus_tag" content="docs-default-current"><meta data-react-helmet="true" property="og:title" content="Coordinating Larger Metaflow Projects | My Site"><meta data-react-helmet="true" name="description" content="Most Metaflow projects start as a simple Python script that is developed by a single data scientist. Metaflow takes care of keeping results organized automatically, so you can focus on developing models and the business logic around them."><meta data-react-helmet="true" property="og:description" content="Most Metaflow projects start as a simple Python script that is developed by a single data scientist. Metaflow takes care of keeping results organized automatically, so you can focus on developing models and the business logic around them."><link data-react-helmet="true" rel="icon" href="/img/favicon.ico"><link data-react-helmet="true" rel="canonical" href="https://your-docusaurus-test-site.com/docs/going-to-production-with-metaflow/coordinating-larger-metaflow-projects"><link data-react-helmet="true" rel="alternate" href="https://your-docusaurus-test-site.com/docs/going-to-production-with-metaflow/coordinating-larger-metaflow-projects" hreflang="en"><link data-react-helmet="true" rel="alternate" href="https://your-docusaurus-test-site.com/docs/going-to-production-with-metaflow/coordinating-larger-metaflow-projects" hreflang="x-default"><link rel="stylesheet" href="/assets/css/styles.f4f4d2e4.css">
<link rel="preload" href="/assets/js/runtime~main.0c3b41c5.js" as="script">
<link rel="preload" href="/assets/js/main.0d825480.js" as="script">
</head>
<body>
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"light")}()</script><div id="__docusaurus">
<div role="region"><a href="#" class="skipToContent_ZgBM">Skip to main content</a></div><nav class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Navigation bar toggle" class="navbar__toggle clean-btn" type="button" tabindex="0"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/"><div class="navbar__logo"><img src="/img/logo.svg" alt="My Site Logo" class="themedImage_W2Cr themedImage--light_TfLj"><img src="/img/logo.svg" alt="My Site Logo" class="themedImage_W2Cr themedImage--dark_oUvU"></div><b class="navbar__title">My Site</b></a></div><div class="navbar__items navbar__items--right"><div class="toggle_Pssr toggle_TdHA toggleDisabled_jDku"><div class="toggleTrack_SSoT" role="button" tabindex="-1"><div class="toggleTrackCheck_XobZ"><span class="toggleIcon_eZtF">ðŸŒœ</span></div><div class="toggleTrackX_YkSC"><span class="toggleIcon_eZtF">ðŸŒž</span></div><div class="toggleTrackThumb_uRm4"></div></div><input type="checkbox" class="toggleScreenReader_JnkT" aria-label="Switch between dark and light mode"></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div class="main-wrapper docs-wrapper docs-doc-page"><div class="docPage_P2Lg"><button aria-label="Scroll back to top" class="clean-btn theme-back-to-top-button backToTopButton_RiI4" type="button"></button><aside class="theme-doc-sidebar-container docSidebarContainer_rKC_"><div class="sidebar_CW9Y"><nav class="menu thin-scrollbar menu_SkdO"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/r/">R Docs</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist hasHref_VCh3" href="/docs/introduction/why-metaflow">Introduction</a></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/introduction/why-metaflow">Why Metaflow</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/introduction/what-is-metaflow">What is Metaflow</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/introduction/release-notes">Release Notes</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/introduction/roadmap">Roadmap</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/introduction/contributing-to-metaflow">Contributing to Metaflow</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/introduction/getting-in-touch">Get in Touch</a></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist hasHref_VCh3" href="/docs/getting-started/install">Getting Started</a></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/getting-started/install">Installing Metaflow</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/getting-started/tutorials/">Tutorials</a></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist hasHref_VCh3" href="/docs/metaflow-on-aws/">Metaflow on AWS</a></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/metaflow-on-aws/">Metaflow on AWS</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/metaflow-on-aws/metaflow-sandbox">Metaflow Sandbox</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/metaflow-on-aws/deploy-to-aws">Deploying to AWS</a></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist hasHref_VCh3" href="/docs/metaflow/basics">Developing with Metaflow</a></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/metaflow/basics">Basics of Metaflow</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/metaflow/client">Inspecting Flows and Results</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/metaflow/visualizing-results/">Visualizing Results</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/metaflow/debugging">Debugging with Metaflow</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/metaflow/scaling">Scaling Out and Up</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/metaflow/data">Loading and Storing Data</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/metaflow/dependencies">Managing External Libraries</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/metaflow/failures">Dealing with Failures</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/metaflow/tagging">Organizing Results</a></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--active hasHref_VCh3" aria-current="page" href="/docs/going-to-production-with-metaflow/scheduling-metaflow-flows">Going to Production with Metaflow</a></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/going-to-production-with-metaflow/scheduling-metaflow-flows">Scheduling Metaflow Flows</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" tabindex="0" href="/docs/going-to-production-with-metaflow/coordinating-larger-metaflow-projects">Coordinating Larger Metaflow Projects</a></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist hasHref_VCh3" href="/docs/internals-of-metaflow/technical-overview">Internals of Metaflow</a></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/internals-of-metaflow/technical-overview">Technical Overview</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/internals-of-metaflow/testing-philosophy">Testing Philosophy</a></li></ul></li></ul></nav></div></aside><main class="docMainContainer_TCnq"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_DM6M"><div class="docItemContainer_vinB"><article><div class="tocCollapsible_jdIR theme-doc-toc-mobile tocMobile_TmEX"><button type="button" class="clean-btn tocCollapsibleButton_Fzxq">On this page</button></div><div class="theme-doc-markdown markdown"><h1>Coordinating Larger Metaflow Projects</h1><p>Most Metaflow projects start as a simple Python script that is developed by a single data scientist. Metaflow takes care of <a href="https://docs.metaflow.org/metaflow/tagging" target="_blank" rel="noopener noreferrer">keeping results organized automatically</a>, so you can focus on developing models and the business logic around them.</p><p>Over time, the project matures to the point that you want to <a href="https://docs.metaflow.org/going-to-production-with-metaflow/scheduling-metaflow-flows" target="_blank" rel="noopener noreferrer">deploy it to AWS Step Functions</a> to test how the model works with real-life, updating data. In Metaflow, this is a matter of executing a single command, step-functions create. Having the workflow run automatically with fresh data is a great way to surface unforeseen issues in the code.</p><p>After a few iterations, the workflow starts to work reliably. If the results are promising enough, stakeholders can start relying on the results of your workflow. Often, success attracts more developers to join the project. At this point, you will need to start thinking how to coordinate work amongst multiple people and how to iterate on new, experimental versions of the workflow while providing stable results to your stakeholders. This is where the <code>@project</code> decorator comes in.</p><h2 class="anchor anchorWithStickyNavbar_mojV" id="the-project-decorator">The <code>@project</code> decorator<a class="hash-link" href="#the-project-decorator" title="Direct link to heading">â€‹</a></h2><p>During development, multiple people can work on the same workflow simultaneously as Metaflow keeps executions isolated through <a href="https://docs.metaflow.org/metaflow/tagging" target="_blank" rel="noopener noreferrer">independently stored artifacts and namespaces</a>. However, by default, all <a href="https://docs.metaflow.org/going-to-production-with-metaflow/scheduling-metaflow-flows" target="_blank" rel="noopener noreferrer">AWS Step Functions deployments</a> are bound to the name of the workflow. If multiple people call <code>step-functions create</code> independently, each deployment will overwrite the previous one.</p><p>In the early stages of a project, this simple model is convenient but as the project grows, it is desirable that multiple people can test their own AWS Step Functions deployments without interference. Or, as a single developer, you may want to experiment with multiple independent AWS Step Functions deployments of your workflow.</p><p>Metaflow provides a <code>@project</code> decorator to address this need. The <code>@project</code> decorator is used at the <code>FlowSpec</code>-level to bind a Flow to a specific project. All flows with the same project name belong to the same project.</p><p>You can test this by executing the following flow.</p><p>{% code title=&quot;project_flow.py&quot; %}</p><div class="codeBlockContainer_I0IT language-python theme-code-block"><div class="codeBlockContent_wNvx python"><pre tabindex="0" class="prism-code language-python codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">from</span><span class="token plain"> metaflow </span><span class="token keyword" style="color:#00009f">import</span><span class="token plain"> FlowSpec</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> step</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> project</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> current</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token decorator annotation punctuation" style="color:#393A34">@project</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">name</span><span class="token operator" style="color:#393A34">=</span><span class="token string" style="color:#e3116c">&#x27;example_project&#x27;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">class</span><span class="token plain"> </span><span class="token class-name">ProjectFlow</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">FlowSpec</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token decorator annotation punctuation" style="color:#393A34">@step</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">def</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">start</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">self</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token keyword" style="color:#00009f">print</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&#x27;project name:&#x27;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> current</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">project_name</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token keyword" style="color:#00009f">print</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&#x27;project branch:&#x27;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> current</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">branch_name</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token keyword" style="color:#00009f">print</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&#x27;is this a production run?&#x27;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> current</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">is_production</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        self</span><span class="token punctuation" style="color:#393A34">.</span><span class="token builtin">next</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">self</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">end</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token decorator annotation punctuation" style="color:#393A34">@step</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">def</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">end</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">self</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token keyword" style="color:#00009f">pass</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">if</span><span class="token plain"> __name__ </span><span class="token operator" style="color:#393A34">==</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;__main__&#x27;</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    ProjectFlow</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><p>{% endcode %}</p><p>Save the above snippet in a file, <code>project_flow.py</code>. Now you can run the flow as usual:</p><div class="codeBlockContainer_I0IT language-python theme-code-block"><div class="codeBlockContent_wNvx python"><pre tabindex="0" class="prism-code language-python codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">python project_flow</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">py run</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><p>The <code>@project</code> decorator exposes new project-related attributes, <code>project_name</code>, <code>branch_name</code>, and <code>is_production</code> in <a href="https://docs.metaflow.org/metaflow/tagging#accessing-current-ids-in-a-flow" target="_blank" rel="noopener noreferrer">the current object</a> which you can use to alter the behavior of the flow depending on the execution context. Besides the new attributes in current, the flow works exactly as before when executed outside AWS Step Functions.</p><h2 class="anchor anchorWithStickyNavbar_mojV" id="projects-on-aws-step-functions">Projects on AWS Step Functions<a class="hash-link" href="#projects-on-aws-step-functions" title="Direct link to heading">â€‹</a></h2><p>The main benefit of <code>@project</code> relates to <a href="https://docs.metaflow.org/going-to-production-with-metaflow/scheduling-metaflow-flows" target="_blank" rel="noopener noreferrer">deployments on AWS Step Functions</a>. Next, we will cover its main use case: Managing a project with multiple developers collaborating.</p><h3 class="anchor anchorWithStickyNavbar_mojV" id="single-flow-multiple-developers">Single Flow, Multiple Developers<a class="hash-link" href="#single-flow-multiple-developers" title="Direct link to heading">â€‹</a></h3><p>If ProjectFlow did not have a @project decorator, it would get deployed as a workflow called ProjectFlow on AWS Step Functions by step-functions create. Only one version of ProjectFlow could exist on AWS Step Functions at a time. Everyone deploying the flow would need to know <a href="https://docs.metaflow.org/metaflow/tagging#production-namespaces" target="_blank" rel="noopener noreferrer">the production token</a> assigned to the deployment.</p><p>On the AWS Step Functions UI, you would see one workflow called <code>ProjectFlow</code>:</p><p><img src="https://lh6.googleusercontent.com/EYiiL19aH222-JgMp4_Quz-TqEmRX1M9bu8wWdW3ColDjFN6rHytxaKv6qh3q-EzDxiz-Ok9r-BEbw1oSJJr7E38NZFqVtucfrEyfMuVdRx6MTwSoLvPtDtwGKvksmpLajomOzp8"></p><p>The <code>@project</code> decorator changes this behavior. Let&#x27;s deploy ProjectFlow:</p><div class="codeBlockContainer_I0IT language-python theme-code-block"><div class="codeBlockContent_wNvx python"><pre tabindex="0" class="prism-code language-python codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">python project_flow</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">py step</span><span class="token operator" style="color:#393A34">-</span><span class="token plain">functions create</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><p>The <code>@project</code> decorator adds a user-specific prefix in the workflow name: the workflow gets deployed with a name like <code>example_project.user.YOURNAME.ProjectFlow</code> where <code>YOURNAME</code> is your user name.</p><p>This allows multiple developers to deploy their workflows on AWS Step Functions without fear that they might interfere with someone else&#x27;s deployment. Imagine Alice, Bob, and Carol collaborating on a project. Each one of them can call <code>step-functions create</code> independently, which results in three separate workflows on AWS Step Functions:</p><p><img src="https://lh5.googleusercontent.com/zAs6l7ZSZEA68ARLaDtwc_V_PHKhvaWHnvvFs2I_QofMnxh8R3-yeGdcPYaXp_UoGpMEfIqJL9kU4ZcT6k_YgqiAvWw8oYGB8hC5TmNXp1-66mmukDIJuLkH6na3zfEDJ2UggTzl"></p><p>Note that each one of these deployments gets <a href="https://docs.metaflow.org/metaflow/tagging" target="_blank" rel="noopener noreferrer">an isolated namespace</a> and <a href="https://docs.metaflow.org/metaflow/tagging#production-tokens" target="_blank" rel="noopener noreferrer">a separate production token</a>. This means that if your code refers to <code>Flow(&#x27;ProjectFlow&#x27;).latest_run</code> on AWS Step Functions, it is guaranteed to refer to a run that corresponds to its own isolated deployment. The deployments don&#x27;t interfere with each other.</p><h4 class="anchor anchorWithStickyNavbar_mojV" id="production-deployment">Production Deployment<a class="hash-link" href="#production-deployment" title="Direct link to heading">â€‹</a></h4><p>In addition to user-specific deployments, most projects have a single blessed production version which represents the official results of the workflow.</p><p>The <code>@project</code> decorator exposes a new top-level command-line argument, <code>--production</code> that denotes a production run or deployment. See what happens when you run ProjectFlow with <code>--production</code>:</p><div class="codeBlockContainer_I0IT language-python theme-code-block"><div class="codeBlockContent_wNvx python"><pre tabindex="0" class="prism-code language-python codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">python project_flow</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">py </span><span class="token operator" style="color:#393A34">-</span><span class="token operator" style="color:#393A34">-</span><span class="token plain">production run</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><p>The <code>current.branch_name</code> will be set to prod and <code>current.is_production</code> is set to True. For instance, you could write results to a production table only if <code>current.is_production</code>.</p><p>You can deploy a production version to AWS Step Functions as follows:</p><div class="codeBlockContainer_I0IT language-python theme-code-block"><div class="codeBlockContent_wNvx python"><pre tabindex="0" class="prism-code language-python codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">python project_flow</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">py </span><span class="token operator" style="color:#393A34">-</span><span class="token operator" style="color:#393A34">-</span><span class="token plain">production step</span><span class="token operator" style="color:#393A34">-</span><span class="token plain">functions create</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><p>Instead of deploying the flow with a user-specific prefix, this will deploy the flow as <code>example_project.prod.ProjectFlow</code>. You will get a warning about missing production token if you are not authorized to deploy the flow to production.</p><p>The production deployment gets a separate, isolated namespace of its own:</p><p><img src="https://lh6.googleusercontent.com/pTFm6xYWlL2wqJNmEwAOYj34wwt_2TLZlDbWrJIEDo2q7ksBOcMlll9kVW-n27cvTw8RKAxUyt9gYD0PgvEwnUWz0m1_daVeR5HeOjuxbBH7WDf1LiwwSwLjs7CGFM48l6RPIvTJ"></p><h4 class="anchor anchorWithStickyNavbar_mojV" id="custom-branches">Custom Branches<a class="hash-link" href="#custom-branches" title="Direct link to heading">â€‹</a></h4><p>Imagine that ProjectFlow has a stable version in production. Now, Alice and Bob want to start developing a new, experimental version of the flow. They can work on a common codebase and run the code locally independently. Eventually, they will want to deploy the experimental version to AWS Step Functions and let it run in parallel with the production version for a while, to see that it works correctly.</p><p>Alice and Bob could deploy the experimental version under a user-specific namespace of theirs but this would make it hard to keep iterating on the code, as one of the user namespaces would be reserved for the long-running experiment. A better approach is to deploy the experimental code under a custom branch.</p><p>Try the following:</p><div class="codeBlockContainer_I0IT language-python theme-code-block"><div class="codeBlockContent_wNvx python"><pre tabindex="0" class="prism-code language-python codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">python project_flow</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">py </span><span class="token operator" style="color:#393A34">-</span><span class="token operator" style="color:#393A34">-</span><span class="token plain">branch better_version run</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><p>The flow reports that the branch name is <code>test.better_version</code>. You can deploy the custom branch to AWS Step Functions:</p><div class="codeBlockContainer_I0IT language-python theme-code-block"><div class="codeBlockContent_wNvx python"><pre tabindex="0" class="prism-code language-python codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">python project_flow</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">py </span><span class="token operator" style="color:#393A34">-</span><span class="token operator" style="color:#393A34">-</span><span class="token plain">branch better_version step</span><span class="token operator" style="color:#393A34">-</span><span class="token plain">functions create</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><p>which will result in another separate, isolated namespace:</p><p><img src="https://lh6.googleusercontent.com/uv8Zt8Rni77skhjJ90kw6pw6VcnOT2whBTSUstZHzT1-1yqOP61UGx8220Jn068xisYlh31wPjrjVl_IWxmVHsLVyRZ1-MPZ911EqTjs3ff2vXJ_MLt7rEnPIJ_QEX6CLIn4p84o"></p><p>Alice and Bob can share the production token corresponding to the branch, so either of them can redeploy the branch when needed.\</p><h4 class="anchor anchorWithStickyNavbar_mojV" id="custom-branches-for-production-deployment">Custom branches for Production deployment<a class="hash-link" href="#custom-branches-for-production-deployment" title="Direct link to heading">â€‹</a></h4><p>There are scenarios where Alice might need to run multiple variants of ProjectFlow in production. Alice can very simply use custom branches to run multiple production versions -</p><p>Try the following:</p><div class="codeBlockContainer_I0IT language-python theme-code-block"><div class="codeBlockContent_wNvx python"><pre tabindex="0" class="prism-code language-python codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">python project_flow</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">py </span><span class="token operator" style="color:#393A34">-</span><span class="token operator" style="color:#393A34">-</span><span class="token plain">branch better_version </span><span class="token operator" style="color:#393A34">-</span><span class="token operator" style="color:#393A34">-</span><span class="token plain">prodduction run</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><p>The flow reports that the branch name is <code>prod.better_version</code>. You can deploy the custom branch to AWS Step Functions:</p><div class="codeBlockContainer_I0IT language-python theme-code-block"><div class="codeBlockContent_wNvx python"><pre tabindex="0" class="prism-code language-python codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">python project_flow</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">py </span><span class="token operator" style="color:#393A34">-</span><span class="token operator" style="color:#393A34">-</span><span class="token plain">branch better_version </span><span class="token operator" style="color:#393A34">-</span><span class="token operator" style="color:#393A34">-</span><span class="token plain">production step</span><span class="token operator" style="color:#393A34">-</span><span class="token plain">functions create</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><h4 class="anchor anchorWithStickyNavbar_mojV" id="summary">Summary<a class="hash-link" href="#summary" title="Direct link to heading">â€‹</a></h4><p>The <code>@project</code> decorator makes available three classes of namespaces that will affect the behavior of <code>step-functions create</code>:</p><ul><li><code>user</code> is the default. It will deploy to a user-specific, private namespace. Use it for testing production deployments.</li><li><code>test</code> denotes custom branches that can be shared amongst multiple users. Use it for deploying experimental versions that can run in parallel with production. Deploy custom branches with <code>--branch foo</code>.</li><li><code>prod</code> denotes the global production namespace. Use it for deploying the official production version of the project. Deploy to production with <code>--production</code>. For multiple production variants, deploy custom branches with <code>--production --branch foo</code>.</li></ul><p>Note that the isolated namespaces offered by <code>@project</code> work best when your code is designed to respect these boundaries. For instance, when writing results to a table, you can use <code>current.branch_name</code> to choose the table to write to or you can disable writes outside production by checking <code>current.is_production</code>.\</p></div><footer class="theme-doc-footer docusaurus-mt-lg"><div class="theme-doc-footer-edit-meta-row row"><div class="col"><a href="https://github.com/facebook/docusaurus/tree/main/packages/create-docusaurus/templates/shared/docs/going-to-production-with-metaflow/coordinating-larger-metaflow-projects.md" target="_blank" rel="noreferrer noopener" class="theme-edit-this-page"><svg fill="currentColor" height="20" width="20" viewBox="0 0 40 40" class="iconEdit_dcUD" aria-hidden="true"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>Edit this page</a></div><div class="col lastUpdated_foO9"></div></div></footer></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Docs pages navigation"><div class="pagination-nav__item"><a class="pagination-nav__link" href="/docs/going-to-production-with-metaflow/scheduling-metaflow-flows"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">Scheduling Metaflow Flows</div></a></div><div class="pagination-nav__item pagination-nav__item--next"><a class="pagination-nav__link" href="/docs/internals-of-metaflow/technical-overview"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">Technical Overview</div></a></div></nav></div></div><div class="col col--3"><div class="tableOfContents_cNA8 thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#the-project-decorator" class="table-of-contents__link toc-highlight">The <code>@project</code> decorator</a></li><li><a href="#projects-on-aws-step-functions" class="table-of-contents__link toc-highlight">Projects on AWS Step Functions</a><ul><li><a href="#single-flow-multiple-developers" class="table-of-contents__link toc-highlight">Single Flow, Multiple Developers</a></li></ul></li></ul></div></div></div></div></main></div></div><footer class="footer footer--dark"><div class="container container-fluid"><div class="row footer__links"><div class="col footer__col"><div class="footer__title">Community</div><ul class="footer__items"><li class="footer__item"><a href="https://stackoverflow.com/questions/tagged/docusaurus" target="_blank" rel="noopener noreferrer" class="footer__link-item"><span>Stack Overflow<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_I5OW"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a></li><li class="footer__item"><a href="https://discordapp.com/invite/docusaurus" target="_blank" rel="noopener noreferrer" class="footer__link-item"><span>Discord<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_I5OW"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a></li><li class="footer__item"><a href="https://twitter.com/docusaurus" target="_blank" rel="noopener noreferrer" class="footer__link-item"><span>Twitter<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_I5OW"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a></li></ul></div><div class="col footer__col"><div class="footer__title">More</div><ul class="footer__items"><li class="footer__item"><a href="https://github.com/facebook/docusaurus" target="_blank" rel="noopener noreferrer" class="footer__link-item"><span>GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_I5OW"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a></li></ul></div></div><div class="footer__bottom text--center"><div class="footer__copyright">Copyright Â© 2022 My Project, Inc. Built with Docusaurus.</div></div></div></footer></div>
<script src="/assets/js/runtime~main.0c3b41c5.js"></script>
<script src="/assets/js/main.0d825480.js"></script>
</body>
</html>